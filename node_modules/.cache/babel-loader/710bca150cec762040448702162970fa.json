{"ast":null,"code":"// Generated by CoffeeScript 1.7.1\n(function () {\n  var AI, AL, BA, BK, CB, CI_BRK, CJ, CP_BRK, CR, DI_BRK, ID, IN_BRK, LF, LineBreaker, NL, NS, PR_BRK, SA, SG, SP, UnicodeTrie, WJ, XX, characterClasses, classTrie, pairTable, _ref, _ref1;\n\n  UnicodeTrie = require('unicode-trie');\n  classTrie = new UnicodeTrie(require('./class_trie.json'));\n  _ref = require('./classes'), BK = _ref.BK, CR = _ref.CR, LF = _ref.LF, NL = _ref.NL, CB = _ref.CB, BA = _ref.BA, SP = _ref.SP, WJ = _ref.WJ, SP = _ref.SP, BK = _ref.BK, LF = _ref.LF, NL = _ref.NL, AI = _ref.AI, AL = _ref.AL, SA = _ref.SA, SG = _ref.SG, XX = _ref.XX, CJ = _ref.CJ, ID = _ref.ID, NS = _ref.NS, characterClasses = _ref.characterClasses;\n  _ref1 = require('./pairs'), DI_BRK = _ref1.DI_BRK, IN_BRK = _ref1.IN_BRK, CI_BRK = _ref1.CI_BRK, CP_BRK = _ref1.CP_BRK, PR_BRK = _ref1.PR_BRK, pairTable = _ref1.pairTable;\n\n  LineBreaker = function () {\n    var Break, mapClass, mapFirst;\n\n    function LineBreaker(string) {\n      this.string = string;\n      this.pos = 0;\n      this.lastPos = 0;\n      this.curClass = null;\n      this.nextClass = null;\n    }\n\n    LineBreaker.prototype.nextCodePoint = function () {\n      var code, next;\n      code = this.string.charCodeAt(this.pos++);\n      next = this.string.charCodeAt(this.pos);\n\n      if (0xd800 <= code && code <= 0xdbff && 0xdc00 <= next && next <= 0xdfff) {\n        this.pos++;\n        return (code - 0xd800) * 0x400 + (next - 0xdc00) + 0x10000;\n      }\n\n      return code;\n    };\n\n    mapClass = function mapClass(c) {\n      switch (c) {\n        case AI:\n          return AL;\n\n        case SA:\n        case SG:\n        case XX:\n          return AL;\n\n        case CJ:\n          return NS;\n\n        default:\n          return c;\n      }\n    };\n\n    mapFirst = function mapFirst(c) {\n      switch (c) {\n        case LF:\n        case NL:\n          return BK;\n\n        case CB:\n          return BA;\n\n        case SP:\n          return WJ;\n\n        default:\n          return c;\n      }\n    };\n\n    LineBreaker.prototype.nextCharClass = function (first) {\n      if (first == null) {\n        first = false;\n      }\n\n      return mapClass(classTrie.get(this.nextCodePoint()));\n    };\n\n    Break = function () {\n      function Break(position, required) {\n        this.position = position;\n        this.required = required != null ? required : false;\n      }\n\n      return Break;\n    }();\n\n    LineBreaker.prototype.nextBreak = function () {\n      var cur, lastClass, shouldBreak;\n\n      if (this.curClass == null) {\n        this.curClass = mapFirst(this.nextCharClass());\n      }\n\n      while (this.pos < this.string.length) {\n        this.lastPos = this.pos;\n        lastClass = this.nextClass;\n        this.nextClass = this.nextCharClass();\n\n        if (this.curClass === BK || this.curClass === CR && this.nextClass !== LF) {\n          this.curClass = mapFirst(mapClass(this.nextClass));\n          return new Break(this.lastPos, true);\n        }\n\n        cur = function () {\n          switch (this.nextClass) {\n            case SP:\n              return this.curClass;\n\n            case BK:\n            case LF:\n            case NL:\n              return BK;\n\n            case CR:\n              return CR;\n\n            case CB:\n              return BA;\n          }\n        }.call(this);\n\n        if (cur != null) {\n          this.curClass = cur;\n\n          if (this.nextClass === CB) {\n            return new Break(this.lastPos);\n          }\n\n          continue;\n        }\n\n        shouldBreak = false;\n\n        switch (pairTable[this.curClass][this.nextClass]) {\n          case DI_BRK:\n            shouldBreak = true;\n            break;\n\n          case IN_BRK:\n            shouldBreak = lastClass === SP;\n            break;\n\n          case CI_BRK:\n            shouldBreak = lastClass === SP;\n\n            if (!shouldBreak) {\n              continue;\n            }\n\n            break;\n\n          case CP_BRK:\n            if (lastClass !== SP) {\n              continue;\n            }\n\n        }\n\n        this.curClass = this.nextClass;\n\n        if (shouldBreak) {\n          return new Break(this.lastPos);\n        }\n      }\n\n      if (this.pos >= this.string.length) {\n        if (this.lastPos < this.string.length) {\n          this.lastPos = this.string.length;\n          return new Break(this.string.length);\n        } else {\n          return null;\n        }\n      }\n    };\n\n    return LineBreaker;\n  }();\n\n  module.exports = LineBreaker;\n}).call(this);","map":null,"metadata":{},"sourceType":"script"}